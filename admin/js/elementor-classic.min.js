tinyMCEPreInit.mceInit.elementorwpeditor.plugins=tinyMCEPreInit.mceInit.elementorwpeditor.plugins||"",tinyMCEPreInit.mceInit.elementorwpeditor.plugins+=",aich_classic_plugin",tinyMCEPreInit.mceInit.elementorwpeditor.toolbar1=tinyMCEPreInit.mceInit.elementorwpeditor.toolbar1||"",tinyMCEPreInit.mceInit.elementorwpeditor.toolbar1+=",aich_classic_plugin_text",tinyMCEPreInit.qtInit.elementorwpeditor.buttons=tinyMCEPreInit.qtInit.elementorwpeditor.buttons||"",tinyMCEPreInit.qtInit.elementorwpeditor.buttons+=",aich_classic_plugin_text",jQuery(document).ready(function(){tinymce.PluginManager.add("aich_classic_plugin",function(e,t){let o=[];for(let n=0;n<aich_ajax.prompts.length;n++){o.push({text:aich_ajax.prompts[n].group_language,disabled:!0,classes:"wp-ai-co-pilot"});for(let i=0;i<aich_ajax.prompts[n].new_prompt.length;i++)o.push({text:aich_ajax.prompts[n].new_prompt[i].prompt_title,classes:"wp-ai-co-pilot",image:void 0!==aich_ajax.prompts[n].new_prompt[i].wp_ai_prompt_icon?aich_ajax.prompts[n].new_prompt[i].wp_ai_prompt_icon.url:aich_ajax.plugin_url+"admin/images/logo.png",onclick:async function(t){let o=e.selection.getContent({format:"text"}),d=e.getContent(),u=new DOMParser().parseFromString(d,"text/html").documentElement.textContent;if(localStorage.setItem("selectedText",o),localStorage.setItem("all_content",u),!a()){m("Please configure open AI successfully.");return}if(l())await Swal.fire({title:"Confirmation",showCancelButton:!0,text:"Interested in Simplifying Content Creation with Ready-made Templates?",showDenyButton:!0,confirmButtonText:"Yes",denyButtonText:"Stay here",cancelButtonText:"Cancel",customClass:{container:"choose_template"}}).then(async o=>{if(o.isConfirmed){let a=t.target.innerText;a=p(a),a=p(a),jQuery(".templates_wrapper").find(`.${a}`).trigger("click"),jQuery(".app_wrapper").fadeIn("slow")}else if(o.isDenied){let l=e.selection.getContent({format:"text"});if(""===l){m("Please select text from editor");return}let d=s("below");e.selection.collapse();let u=tinymce.activeEditor.dom.select("#"+d),g="";if("dalee"===aich_ajax.prompts[n].new_prompt[i].ai_model||"pixabay"===aich_ajax.prompts[n].new_prompt[i].ai_model||"stable-diffusion-v1-6"===aich_ajax.prompts[n].new_prompt[i].ai_model||"stable-diffusion-xl-1024-v1-0"===aich_ajax.prompts[n].new_prompt[i].ai_model||"pexels"===aich_ajax.prompts[n].new_prompt[i].ai_model||"unsplash"===aich_ajax.prompts[n].new_prompt[i].ai_model)g=`<img src="${g=await r(i,l,aich_ajax.prompts[n].prompt_language,aich_ajax.prompts[n].new_prompt[i])}" alt='generated-image' />`;else try{g=await c(i,l,aich_ajax.prompts[n].prompt_language,aich_ajax.prompts[n].new_prompt[i])}catch(w){m(JSON.parse(w.message).message);return}tinymce.dom.DomQuery(u).removeAttr("class"),tinymce.dom.DomQuery(u).removeAttr("id"),tinymce.dom.DomQuery(u).html(g),e.undoManager.add()}else if(o.isDismissed)return!0});else{let g=e.selection.getContent({format:"text"});if(""===g){m("Please select text from block");return}let w=s("below");e.selection.collapse();let f=tinymce.activeEditor.dom.select("#"+w),y="";y=await c(i,g,aich_ajax.prompts[n].prompt_language,aich_ajax.prompts[n].new_prompt[i]),tinymce.dom.DomQuery(f).removeAttr("class"),tinymce.dom.DomQuery(f).removeAttr("id"),tinymce.dom.DomQuery(f).html(y),e.undoManager.add()}}})}let r=async function(e,t,o,n){let i=window.location.search,r=new URLSearchParams(i),a=r.get("post"),l={prompt_title:n.prompt_title,form_data:[t],prompt_content:n.prompt_content,ai_model:n.ai_model,prompt:n.prompt_content,max_tokens:n.word_count,post_id:a,media_type:n.pixabay_media_type,additional_data:{toneOfVoice:"",aiAudience:""}},p=await fetch("/wp-json/wp-ai-co-pilot-pro/generate/v1/generate-image",{method:"POST",body:JSON.stringify(l)});if(!p.ok){m(p.text());return}let s=await p.json();return JSON.parse(s.contents)[0].text};function a(){return aich_ajax.api_key_is_valid}function l(){return aich_ajax.pro_activated}function p(e){e=(e=e.replace(/^\s+|\s+$/g,"")).toLowerCase();let t="\xe0\xe1\xe3\xe4\xe2\xe8\xe9\xeb\xea\xec\xed\xef\xee\xf2\xf3\xf6\xf4\xf9\xfa\xfc\xfb\xf1\xe7\xb7/_,:;";for(let o=0,n=t.length;o<n;o++)e=e.replace(RegExp(t.charAt(o),"g"),"aaaaaeeeeiiiioooouuuunc------".charAt(o));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function s(t){tinymce.activeEditor.dom;let o=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),n=e.selection.getRng();if("below"===t){let i=e.selection.getEnd(),r=d(i,t,o),a=tinymce.dom.DomQuery(r)[0];"li"===n.endContainer.parentNode.tagName.toLowerCase()?tinymce.dom.DomQuery(i).after(a):i.textContent?(n.collapse(!1),n.insertNode(a),e.selection.collapse()):tinymce.dom.DomQuery(i).after(a)}else{let l=e.selection.getStart(),p=d(l,t,o),s=tinymce.dom.DomQuery(p)[0];"li"===n.startContainer.parentNode.tagName.toLowerCase()?tinymce.dom.DomQuery(l).before(s):l.textContent?(n.collapse(!0),n.insertNode(s),e.selection.collapse()):tinymce.dom.DomQuery(l).before(s)}return e.undoManager.add(),o}function m(e){Swal.fire({icon:"error",title:"Oops...",text:e})}e.addButton("aich_classic_plugin_text",{title:"WP AI Co Pilot",image:aich_ajax.plugin_url+"admin/images/logo.png",tooltip:"Generate content by WP AI Co-pilot",addClasses:"wp-ai-co-pilot",type:"menubutton",menu:o}),jQuery(document).on("click",".generate-item__bottom__icons .tooltip-box .action-btn.insert_content",function(){let t=jQuery(this).data("content");"image"===jQuery(this).data("type")&&(t=`<img src='${t}' alt='generated-content' />`);let o=s("below");e.selection.collapse();let n=tinymce.activeEditor.dom.select("#"+o);tinymce.dom.DomQuery(n).removeAttr("class"),tinymce.dom.DomQuery(n).removeAttr("id"),tinymce.dom.DomQuery(n).html(t),e.undoManager.add(),jQuery(".single_template .sidebar_inner_wrap .back_btn_trigger").trigger("click"),jQuery(".app_wrapper .close").trigger("click")});let c=async function(e,t,o,n){let i=await fetch("/wp-json/ai-content-helper/openai/v1/generated-content",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":aich_ajax.nonce},body:JSON.stringify({requestType:e,text:[t],language:o,promptItem:n})});if(!i.ok){m("There is something wrong with the settings, please fix it.");return}let r=await i.json();return r.text},d=function(e,t,o){let n="";return n="li"===e.tagName.toLowerCase()?`<${e.tagName} id="${o}" class="aich-loading">&nbsp;</${e.tagName}>`:`<p id="${o}" class="aich-loading">&nbsp;</p>`,jQuery(".aich-loading").css("width","45px"),n}})}),tinyMCEPreInit.mceInit.elementorwpeditor.plugins+=",wp_ai_co_pilot_pro_classic",tinyMCEPreInit.mceInit.elementorwpeditor.toolbar1=tinyMCEPreInit.mceInit.elementorwpeditor.toolbar1||"",tinyMCEPreInit.mceInit.elementorwpeditor.toolbar1+=",wp_ai_co_pilot_pro_classic_text",tinyMCEPreInit.qtInit.elementorwpeditor.buttons=tinyMCEPreInit.qtInit.elementorwpeditor.buttons||"",tinyMCEPreInit.qtInit.elementorwpeditor.buttons+=",wp_ai_co_pilot_pro_classic_text",jQuery(document).ready(function(){tinymce.PluginManager.add("wp_ai_co_pilot_pro_classic",function(e,t){aich_ajax.pro_activated&&e.addButton("wp_ai_co_pilot_pro_classic_text",{title:"WP AI Co-Pilot Generate button",image:aich_ajax.plugin_url+"admin/images/logo.png",tooltip:"WP AI Co-Pilot Generate button",class:"wp-ai-co-pilot",onclick:function(){let t=e.selection.getContent({format:"text"}),o=e.getContent(),n=new DOMParser().parseFromString(o,"text/html").documentElement.textContent;localStorage.setItem("selectedText",t),localStorage.setItem("all_content",n),jQuery(".app_wrapper").fadeIn()}})})});